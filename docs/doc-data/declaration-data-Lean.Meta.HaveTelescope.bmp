{"declarations":[{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.simpHaveTelescope\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">simpHaveTelescope</span></a></span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">{<span class=\"fn\">m</span> : <span class=\"fn\"><a href=\"./foundational_types.html\">Type</a> → <a href=\"./foundational_types.html\">Type</a></span>}</span></span>\n</span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">[<span class=\"fn\"><a href=\"./Init/Prelude.html#Monad\">Monad</a> <span class=\"fn\">m</span></span>]</span></span>\n</span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">[<span class=\"fn\"><a href=\"./Init/Prelude.html#MonadLiftT\">MonadLiftT</a> <a href=\"./Lean/Meta/Basic.html#Lean.Meta.MetaM\">MetaM</a> <span class=\"fn\">m</span></span>]</span></span>\n</span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">[<span class=\"fn\"><a href=\"./Init/Control/Basic.html#MonadControlT\">MonadControlT</a> <a href=\"./Lean/Meta/Basic.html#Lean.Meta.MetaM\">MetaM</a> <span class=\"fn\">m</span></span>]</span></span>\n</span><span class=\"impl_arg\"><span class=\"decl_args\">\n<span class=\"fn\">[<span class=\"fn\"><a href=\"./Lean/Meta/MonadSimp.html#Lean.Meta.MonadSimp\">MonadSimp</a> <span class=\"fn\">m</span></span>]</span></span>\n</span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">e</span> : <a href=\"./Lean/Expr.html#Lean.Expr\">Expr</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">zetaUnusedMode</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode\">ZetaUnusedMode</a> := <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode.twoPasses\">ZetaUnusedMode.twoPasses</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><span class=\"fn\">m</span> <a href=\"./Lean/Meta/MonadSimp.html#Lean.Meta.MonadSimp.Result\">MonadSimp.Result</a></span></div></div>","info":{"doc":"Routine for simplifying `have` telescopes. Used by `simpLet`.\nThis is optimized to be able to handle deep `have` telescopes while avoiding quadratic complexity\narising from the locally nameless expression representations.\n\n## Overview\n\nConsider a `have` telescope:\n```\nhave x₁ : T₁ := v₁; ...; have xₙ : Tₙ := vₙ; b\n```\nWe say `xᵢ` is *fixed* if it appears in the type of `b`.\nIf `xᵢ` is fixed, then it can only be rewritten using definitional equalities.\nOtherwise, we can freely rewrite the value using a propositional equality `vᵢ = vᵢ'`.\nThe body `b` can always be freely rewritten using a propositional equality `b = b'`.\n(All the mentioned equalities must be type correct with respect to the obvious local contexts.)\n\nIf `xᵢ` neither appears in `b` nor any `Tⱼ` nor any `vⱼ`, then its `have` is *unused*.\nUnused `have`s can be eliminated, which we do if `cfg.zetaUnused` is true.\nWe clear `have`s from the end, to be able to transitively clear chains of unused `have`s.\nThis is why we honor `zetaUnused` here even though `reduceStep` is also responsible for it;\n`reduceStep` can only eliminate unused `have`s at the start of a telescope.\nEliminating all transitively unused `have`s at once like this also avoids quadratic complexity.\n\nIf `debug.simp.check.have` is enabled then we typecheck the resulting expression and proof.\n\n## Proof generation\n\nThere are two main complications with generating proofs.\n1. We work almost exclusively with expressions with loose bound variables,\n   to avoid overhead from instantiating and abstracting free variables,\n   which can lead to complexity quadratic in the telescope length.\n   (See `HaveTelescopeInfo`.)\n2. We want to avoid triggering zeta reductions in the kernel.\n\nRegarding this second point, the issue is that we cannot organize the proof using congruence theorems\nin the obvious way. For example, given\n```\ntheorem have_congr {α : Sort u} {β : Sort v} {a a' : α} {f f' : α → β}\n    (h₁ : a = a') (h₂ : ∀ x, f x = f' x) :\n    (have x := a; f x) = (have x := a'; f' x)\n```\nthe kernel sees that the type of `have_congr (fun x => b) (fun x => b') h₁ h₂`\nis `(have x := a; (fun x => b) x) = (have x := a'; (fun x => b') x)`,\nsince when instantiating values it does not beta reduce at the same time.\nHence, when `is_def_eq` is applied to the LHS and `have x := a; b` for example,\nit will do `whnf_core` to both sides.\n\nInstead, we use the form `(fun x => b) a = (fun x => b') a'` in the proofs,\nwhich we can reliably match up without triggering beta reductions in the kernel.\nThe zeta/beta reductions are then limited to the type hint for the entire telescope,\nwhen we convert this back into `have` form.\nIn the base case, we include an optimization to avoid unnecessary zeta/beta reductions,\nby detecting a `simpHaveTelescope` proofs and removing the type hint.\n","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.simpHaveTelescope","kind":"def","line":399,"name":"Lean.Meta.simpHaveTelescope","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L399-L459"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.zetaUnused\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">zetaUnused</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">e</span> : <a href=\"./Lean/Expr.html#Lean.Expr\">Expr</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Meta/Basic.html#Lean.Meta.MetaM\">MetaM</a> <a href=\"./Lean/Expr.html#Lean.Expr\">Expr</a></span></div></div>","info":{"doc":"Remove unused-let declarations. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.zetaUnused","kind":"def","line":343,"name":"Lean.Meta.zetaUnused","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L343-L361"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode.twoPasses\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">ZetaUnusedMode</span>.<span class=\"name\">twoPasses</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode\">ZetaUnusedMode</a></div></div>","info":{"doc":"Simplify and then eliminate unused `let`-declarations. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode.twoPasses","kind":"ctor","line":340,"name":"Lean.Meta.ZetaUnusedMode.twoPasses","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L340-L341"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode.singlePass\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">ZetaUnusedMode</span>.<span class=\"name\">singlePass</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode\">ZetaUnusedMode</a></div></div>","info":{"doc":"Simplify and eliminate unused `let`-declarations in a single pass. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode.singlePass","kind":"ctor","line":338,"name":"Lean.Meta.ZetaUnusedMode.singlePass","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L338-L339"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode.no\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">ZetaUnusedMode</span>.<span class=\"name\">no</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode\">ZetaUnusedMode</a></div></div>","info":{"doc":"Do not eliminate unused `let`-declarations. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode.no","kind":"ctor","line":336,"name":"Lean.Meta.ZetaUnusedMode.no","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L336-L337"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">inductive</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">ZetaUnusedMode</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>","info":{"doc":"Configuration for specifying how unused let-declarations are eliminated. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.ZetaUnusedMode","kind":"inductive","line":334,"name":"Lean.Meta.ZetaUnusedMode","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L334-L341"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.computeFixedUsed\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span>.<span class=\"name\">computeFixedUsed</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">info</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">keepUnused</span> : <a href=\"./Init/Prelude.html#Bool\">Bool</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Meta/Basic.html#Lean.Meta.MetaM\">MetaM</a> (<span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Init/Prelude.html#Bool\">Bool</a></span> <a href=\"./Init/Prelude.html#Prod\">×</a> <span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Init/Prelude.html#Bool\">Bool</a></span>)</span></div></div>","info":{"doc":"Computes which `have`s in the telescope are fixed and which are unused.\nThe length of the unused array may be less than the number of `have`s: use `unused.getD i true`.\n","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.computeFixedUsed","kind":"def","line":128,"name":"Lean.Meta.HaveTelescopeInfo.computeFixedUsed","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L128-L156"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.getHaveTelescopeInfo\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">getHaveTelescopeInfo</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">e</span> : <a href=\"./Lean/Expr.html#Lean.Expr\">Expr</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Lean/Meta/Basic.html#Lean.Meta.MetaM\">MetaM</a> <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a></span></div></div>","info":{"doc":"Efficiently collect dependency information for a `have` telescope.\nThis is part of a scheme to avoid quadratic overhead from the locally nameless discipline\n(see `HaveTelescopeInfo` and `simpHaveTelescope`).\n\nThe expression `e` must not have loose bvars.\n","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.getHaveTelescopeInfo","kind":"def","line":80,"name":"Lean.Meta.getHaveTelescopeInfo","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L80-L126"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.instInhabitedHaveTelescopeInfo.default\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">instInhabitedHaveTelescopeInfo</span>.<span class=\"name\">default</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a></div></div>","info":{"doc":"","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.instInhabitedHaveTelescopeInfo.default","kind":"def","line":78,"name":"Lean.Meta.instInhabitedHaveTelescopeInfo.default","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L78-L78"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">instance</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.instInhabitedHaveTelescopeInfo\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">instInhabitedHaveTelescopeInfo</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Inhabited\">Inhabited</a> <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a></span></div></div>","info":{"doc":"","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.instInhabitedHaveTelescopeInfo","kind":"instance","line":78,"name":"Lean.Meta.instInhabitedHaveTelescopeInfo","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L78-L78"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.level\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span>.<span class=\"name\">level</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Level.html#Lean.Level\">Level</a></div></div>","info":{"doc":"The universe level for the `have` expression, cached. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.level","kind":"def","line":77,"name":"Lean.Meta.HaveTelescopeInfo.level","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L77-L77"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.bodyType\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span>.<span class=\"name\">bodyType</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Expr.html#Lean.Expr\">Expr</a></div></div>","info":{"doc":"A cached version of the telescope body's type, instantiated with fvars from each `HaveInfo.decl`. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.bodyType","kind":"def","line":75,"name":"Lean.Meta.HaveTelescopeInfo.bodyType","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L75-L75"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.body\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span>.<span class=\"name\">body</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Expr.html#Lean.Expr\">Expr</a></div></div>","info":{"doc":"A cached version of the telescope body, instantiated with fvars from each `HaveInfo.decl`. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.body","kind":"def","line":73,"name":"Lean.Meta.HaveTelescopeInfo.body","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L73-L73"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.bodyTypeDeps\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span>.<span class=\"name\">bodyTypeDeps</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Std/Data/HashSet/Basic.html#Std.HashSet\">Std.HashSet</a> <a href=\"./Init/Prelude.html#Nat\">Nat</a></span></div></div>","info":{"doc":"The set of `have`s that the type of the body depends on, as indices into `haveInfo`.\nThis is the set of fixed `have`s. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.bodyTypeDeps","kind":"def","line":71,"name":"Lean.Meta.HaveTelescopeInfo.bodyTypeDeps","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L71-L71"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.bodyDeps\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span>.<span class=\"name\">bodyDeps</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Std/Data/HashSet/Basic.html#Std.HashSet\">Std.HashSet</a> <a href=\"./Init/Prelude.html#Nat\">Nat</a></span></div></div>","info":{"doc":"The set of `have`s that the body depends on, as indices into `haveInfo`.\nUsed in `computeFixedUsed` to compute used `have`s. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.bodyDeps","kind":"def","line":68,"name":"Lean.Meta.HaveTelescopeInfo.bodyDeps","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L68-L68"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.haveInfo\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span>.<span class=\"name\">haveInfo</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a></span></div></div>","info":{"doc":"Information about each `have` in the telescope. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.haveInfo","kind":"def","line":65,"name":"Lean.Meta.HaveTelescopeInfo.haveInfo","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L65-L65"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">haveInfo</span> : <span class=\"fn\"><a href=\"./Init/Prelude.html#Array\">Array</a> <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">bodyDeps </span><span class=\"fn\">bodyTypeDeps</span> : <span class=\"fn\"><a href=\"./Std/Data/HashSet/Basic.html#Std.HashSet\">Std.HashSet</a> <a href=\"./Init/Prelude.html#Nat\">Nat</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">body </span><span class=\"fn\">bodyType</span> : <a href=\"./Lean/Expr.html#Lean.Expr\">Expr</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">level</span> : <a href=\"./Lean/Level.html#Lean.Level\">Level</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\">HaveTelescopeInfo</a></div></div>","info":{"doc":"","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo.mk","kind":"ctor","line":63,"name":"Lean.Meta.HaveTelescopeInfo.mk","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L63-L63"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveTelescopeInfo</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>","info":{"doc":"Information about a `have` telescope.\nCreated by `getHaveTelescopeInfo` and used in `simpHaveTelescope`.\n\nThe data is used to avoid applying `Expr.abstract` more than once on any given subexpression\nwhen constructing terms and proofs during simplification. Abstraction is linear in the size `t` of a term,\nand so in a depth-`n` telescope it is `O(nt)`, quadratic in `n`, since `n ≤ t`.\nFor example, given `have x₁ := v₁; ...; have xₙ := vₙ; b` and `h : b = b'`, we need to construct\n```lean\nhave_body_congr (fun x₁ => ... have_body_congr (fun xₙ => h)))\n```\nWe apply `Expr.abstract` to `h` *once* and then build the term, rather than\nusing `mkLambdaFVars #[fvarᵢ] pfᵢ` at each step.\n\nAs an additional optimization, we save the fvar-instantiated terms calculated by `getHaveTelescopeInfo`\nso that we don't have to compute them again. This is only saving a constant factor.\n\nIt is also used for computing used `have`s in `computeFixedUsed`.\nIn `have x₁ := v; have x₂ := x₁; ⋯; have xₙ := xₙ₋₁; b`, if `xₙ` is unused in `b`, then all the\n`have`s are unused. Without a global computation of used `have`s, the proof term would be quadratic\nin the number of `have`s (with `n` iterations of `simp`). Knowing which `have`s are transitively\nunused lets the proof term be linear in size.\n","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveTelescopeInfo","kind":"structure","line":40,"name":"Lean.Meta.HaveTelescopeInfo","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L40-L78"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">instance</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.instInhabitedHaveInfo\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">instInhabitedHaveInfo</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Init/Prelude.html#Inhabited\">Inhabited</a> <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a></span></div></div>","info":{"doc":"","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.instInhabitedHaveInfo","kind":"instance","line":38,"name":"Lean.Meta.instInhabitedHaveInfo","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L38-L38"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">def</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.instInhabitedHaveInfo.default\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">instInhabitedHaveInfo</span>.<span class=\"name\">default</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a></div></div>","info":{"doc":"","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.instInhabitedHaveInfo.default","kind":"def","line":38,"name":"Lean.Meta.instInhabitedHaveInfo.default","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L38-L38"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.level\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveInfo</span>.<span class=\"name\">level</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Level.html#Lean.Level\">Level</a></div></div>","info":{"doc":"The level of the type for this `have`, cached. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.level","kind":"def","line":37,"name":"Lean.Meta.HaveInfo.level","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L37-L37"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.decl\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveInfo</span>.<span class=\"name\">decl</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/LocalContext.html#Lean.LocalDecl\">LocalDecl</a></div></div>","info":{"doc":"The local decl for the `have`, so that the local context can be re-entered `have`-by-`have`.\nN.B. This stores the fvarid for the `have` as well as cached versions of the value and type\ninstantiated with the fvars from the telescope. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.decl","kind":"def","line":35,"name":"Lean.Meta.HaveInfo.decl","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L35-L35"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.valueBackDeps\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveInfo</span>.<span class=\"name\">valueBackDeps</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Std/Data/HashSet/Basic.html#Std.HashSet\">Std.HashSet</a> <a href=\"./Init/Prelude.html#Nat\">Nat</a></span></div></div>","info":{"doc":"Previous `have`s that the value of this `have` depends on, as indices into `HaveTelescopeInfo.haveInfo`.\nUsed in `computeFixedUsed` to compute used `have`s. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.valueBackDeps","kind":"def","line":31,"name":"Lean.Meta.HaveInfo.valueBackDeps","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L31-L31"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">abbrev</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.typeBackDeps\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveInfo</span>.<span class=\"name\">typeBackDeps</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">self</span> : <a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><span class=\"fn\"><a href=\"./Std/Data/HashSet/Basic.html#Std.HashSet\">Std.HashSet</a> <a href=\"./Init/Prelude.html#Nat\">Nat</a></span></div></div>","info":{"doc":"Previous `have`s that the type of this `have` depends on, as indices into `HaveTelescopeInfo.haveInfo`.\nUsed in `computeFixedUsed` to compute used `have`s. ","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.typeBackDeps","kind":"def","line":28,"name":"Lean.Meta.HaveInfo.typeBackDeps","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L28-L28"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">constructor</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.mk\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveInfo</span>.<span class=\"name\">mk</span></a></span><span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">typeBackDeps </span><span class=\"fn\">valueBackDeps</span> : <span class=\"fn\"><a href=\"./Std/Data/HashSet/Basic.html#Std.HashSet\">Std.HashSet</a> <a href=\"./Init/Prelude.html#Nat\">Nat</a></span>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">decl</span> : <a href=\"./Lean/LocalContext.html#Lean.LocalDecl\">LocalDecl</a>)</span></span>\n<span class=\"decl_args\">\n<span class=\"fn\">(<span class=\"fn\">level</span> : <a href=\"./Lean/Level.html#Lean.Level\">Level</a>)</span></span>\n<span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\">HaveInfo</a></div></div>","info":{"doc":"","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo.mk","kind":"ctor","line":25,"name":"Lean.Meta.HaveInfo.mk","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L25-L25"}},{"header":"<div class=\"decl_header\"><span class=\"decl_kind\">structure</span>\n<span class=\"decl_name\"><a class=\"break_within\" href=\"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo\"><span class=\"name\">Lean</span>.<span class=\"name\">Meta</span>.<span class=\"name\">HaveInfo</span></a></span><span class=\"decl_args\"> :</span><div class=\"decl_type\"><a href=\"./foundational_types.html\">Type</a></div></div>","info":{"doc":"Information about a single `have` in a `have` telescope.\nCreated by `getHaveTelescopeInfo`.\n","docLink":"./Lean/Meta/HaveTelescope.html#Lean.Meta.HaveInfo","kind":"structure","line":21,"name":"Lean.Meta.HaveInfo","sourceLink":"https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/HaveTelescope.lean#L21-L38"}}],"imports":["Lean.Meta.Basic","Lean.Meta.MonadSimp","Lean.Util.CollectFVars","Lean.Util.CollectLooseBVars","Lean.Meta.AppBuilder","Init.While"],"instances":[{"className":"Inhabited","name":"Lean.Meta.instInhabitedHaveInfo","typeNames":["Lean.Meta.HaveInfo"]},{"className":"Inhabited","name":"Lean.Meta.instInhabitedHaveTelescopeInfo","typeNames":["Lean.Meta.HaveTelescopeInfo"]}],"name":"Lean.Meta.HaveTelescope"}