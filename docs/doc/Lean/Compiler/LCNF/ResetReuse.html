<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../../.././style.css"></link><link rel="icon" href="../../.././favicon.svg"></link><link rel="mask-icon" href="../../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Compiler.LCNF.ResetReuse</title><script defer="true" src="../../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../../.././";</script><script>const MODULE_NAME="Lean.Compiler.LCNF.ResetReuse";</script><script type="module" src="../../.././jump-src.js"></script><script type="module" src="../../.././search.js"></script><script type="module" src="../../.././expand-nav.js"></script><script type="module" src="../../.././how-about.js"></script><script type="module" src="../../.././instances.js"></script><script type="module" src="../../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Compiler</span>.<span class="name">LCNF</span>.<span class="name">ResetReuse</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Compiler/LCNF/ResetReuse.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../../.././Lean/Compiler/LCNF/CompilerM.html">Lean.Compiler.LCNF.CompilerM</a></li><li><a href="../../.././Lean/Compiler/LCNF/DependsOn.html">Lean.Compiler.LCNF.DependsOn</a></li><li><a href="../../.././Lean/Compiler/LCNF/LiveVars.html">Lean.Compiler.LCNF.LiveVars</a></li><li><a href="../../.././Lean/Compiler/LCNF/PassManager.html">Lean.Compiler.LCNF.PassManager</a></li><li><a href="../../.././Lean/Compiler/LCNF/PhaseExt.html">Lean.Compiler.LCNF.PhaseExt</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Compiler.LCNF.ResetReuse" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Compiler.LCNF.insertResetReuse"><span class="name">Lean</span>.<span class="name">Compiler</span>.<span class="name">LCNF</span>.<span class="name">insertResetReuse</span></a></div></nav><main>
<div class="mod_doc"><p>This module implements the insertion of reset-reuse instructions into lambda pure as described in
&quot;Counting Immutable Beans&quot; (<a href="https://arxiv.org/pdf/1908.05647">https://arxiv.org/pdf/1908.05647</a>). The insertion happens before we
add low-level reference counting and other memory management related operations. In addition to the
IR specified in the paper this implementation supports join points and several operations for
unboxed data.</p><p>The algorithm attempts to identify situations where we potentially free a piece of memory and
shortly after re-allocate memory of the same shape as the memory that was just freed. It then
inserts addition instructions to attempt to reuse the memory right away instead of going through the
allocator.</p><p>For this the paper defines three functions:</p><ul><li><code>R</code> (called <code>Decl.<a href="../../.././Lean/Compiler/LCNF/ResetReuse.html#Lean.Compiler.LCNF.insertResetReuse">insertResetReuse</a></code> here) which looks for candidates that might be elligible for
reuse. For these variables it invokes <code>D</code>.</li><li><code>D</code> which looks for code regions in which the target variable is dead (i.e. no longer read from),
it then invokes <code>S</code>. If <code>S</code> succeeds it inserts a <code>reset</code> instruction to match the <code>reuse</code>
inserted by <code>S</code>.</li><li><code>S</code> which looks for allocations where reusing the target variable could be useful and replaces the
allocation instructions with <code>reuse</code> instructions, otherwise fails and returns the code unmodified.</li></ul></div><div class="decl" id="Lean.Compiler.LCNF.insertResetReuse"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Compiler/LCNF/ResetReuse.lean#L317-L318">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Compiler/LCNF/ResetReuse.html#Lean.Compiler.LCNF.insertResetReuse"><span class="name">Lean</span>.<span class="name">Compiler</span>.<span class="name">LCNF</span>.<span class="name">insertResetReuse</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Lean/Compiler/LCNF/PassManager.html#Lean.Compiler.LCNF.Pass">Pass</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../../.././Lean/Compiler/LCNF/ResetReuse.html#Lean.Compiler.LCNF.insertResetReuse">Lean.Compiler.LCNF.insertResetReuse</a> <a href="../../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../../.././Lean/Compiler/LCNF/PassManager.html#Lean.Compiler.LCNF.Pass.mkPerDeclaration">Lean.Compiler.LCNF.Pass.mkPerDeclaration</a> <span class="fn">`resetReuse</span> <a href="../../.././Lean/Compiler/LCNF/CompilerM.html#Lean.Compiler.LCNF.Phase.impure">Lean.Compiler.LCNF.Phase.impure</a>
    <a href="../../.././Lean/Compiler/LCNF/ResetReuse.html#_private.Lean.Compiler.LCNF.ResetReuse.0.Lean.Compiler.LCNF.Decl.insertResetReuse">Lean.Compiler.LCNF.Decl.insertResetReuse‚úù</a></span></li></ul></details><details id="instances-for-list-Lean.Compiler.LCNF.insertResetReuse" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>