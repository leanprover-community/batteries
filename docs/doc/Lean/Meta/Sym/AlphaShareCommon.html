<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../../.././style.css"></link><link rel="icon" href="../../.././favicon.svg"></link><link rel="mask-icon" href="../../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Meta.Sym.AlphaShareCommon</title><script defer="true" src="../../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../../.././";</script><script>const MODULE_NAME="Lean.Meta.Sym.AlphaShareCommon";</script><script type="module" src="../../.././jump-src.js"></script><script type="module" src="../../.././search.js"></script><script type="module" src="../../.././expand-nav.js"></script><script type="module" src="../../.././how-about.js"></script><script type="module" src="../../.././instances.js"></script><script type="module" src="../../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">AlphaShareCommon</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/Sym/AlphaShareCommon.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../../.././Lean/Meta/Sym/ExprPtr.html">Lean.Meta.Sym.ExprPtr</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Meta.Sym.AlphaShareCommon" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.Sym.AlphaKey"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">AlphaKey</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.Sym.instHashableAlphaKey"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">instHashableAlphaKey</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.Sym.instBEqAlphaKey"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">instBEqAlphaKey</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.Sym.AlphaShareCommon.State"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">AlphaShareCommon</span>.<span class="name">State</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.Sym.AlphaShareCommonM"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">AlphaShareCommonM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.Sym.shareCommonAlpha"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">shareCommonAlpha</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Meta.Sym.shareCommonAlphaInc"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">shareCommonAlphaInc</span></a></div></nav><main>
<div class="decl" id="Lean.Meta.Sym.AlphaKey"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/Sym/AlphaShareCommon.lean#L52-L53">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaKey"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">AlphaKey</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Meta.Sym.AlphaKey.mk"><li id="Lean.Meta.Sym.AlphaKey.expr" class="structure_field"><div class="structure_field_info">expr : <a href="../../.././Lean/Expr.html#Lean.Expr">Expr</a></div></li></ul><details id="instances-for-list-Lean.Meta.Sym.AlphaKey" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.Sym.instHashableAlphaKey"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/Sym/AlphaShareCommon.lean#L55-L56">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.instHashableAlphaKey"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">instHashableAlphaKey</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#Hashable">Hashable</a> <a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaKey">AlphaKey</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.instHashableAlphaKey">Lean.Meta.Sym.instHashableAlphaKey</a> <a href="../../.././Init/Prelude.html#Eq">=</a>   <a href="../../.././Init/Prelude.html#Hashable.mk">{</a> <span class="fn">hash</span> := <span class="fn">fun (<span class="fn">k</span> : <a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaKey">Lean.Meta.Sym.AlphaKey</a>) =&gt; <span class="fn"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.instHashableAlphaKey._private_1">Lean.Meta.Sym.instHashableAlphaKey._private_1</a> <span class="fn">k</span></span></span> <a href="../../.././Init/Prelude.html#Hashable.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Meta.Sym.instBEqAlphaKey"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/Sym/AlphaShareCommon.lean#L58-L59">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.instBEqAlphaKey"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">instBEqAlphaKey</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Prelude.html#BEq">BEq</a> <a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaKey">AlphaKey</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.instBEqAlphaKey">Lean.Meta.Sym.instBEqAlphaKey</a> <a href="../../.././Init/Prelude.html#Eq">=</a>   <a href="../../.././Init/Prelude.html#BEq.mk">{</a> <span class="fn">beq</span> := <span class="fn">fun (<span class="fn">k₁</span> <span class="fn">k₂</span> : <a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaKey">Lean.Meta.Sym.AlphaKey</a>) =&gt; <span class="fn"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.instBEqAlphaKey._private_1">Lean.Meta.Sym.instBEqAlphaKey._private_1</a> <span class="fn">k₁</span> <span class="fn">k₂</span></span></span> <a href="../../.././Init/Prelude.html#BEq.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Meta.Sym.AlphaShareCommon.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/Sym/AlphaShareCommon.lean#L61-L62">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaShareCommon.State"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">AlphaShareCommon</span>.<span class="name">State</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Meta.Sym.AlphaShareCommon.State.mk"><li id="Lean.Meta.Sym.AlphaShareCommon.State.set" class="structure_field"><div class="structure_field_info">set : <span class="fn"><a href="../../.././Lean/Data/PersistentHashSet.html#Lean.PHashSet">PHashSet</a> <a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaKey">AlphaKey</a></span></div></li></ul><details id="instances-for-list-Lean.Meta.Sym.AlphaShareCommon.State" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.Sym.AlphaShareCommonM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/Sym/AlphaShareCommon.lean#L64-L64">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaShareCommonM"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">AlphaShareCommonM</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././foundational_types.html">Type</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaShareCommonM">Lean.Meta.Sym.AlphaShareCommonM</a> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../../.././Init/Control/State.html#StateM">StateM</a> <a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaShareCommon.State">Lean.Meta.Sym.AlphaShareCommon.State</a></span></li></ul></details><details id="instances-for-list-Lean.Meta.Sym.AlphaShareCommonM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.Sym.shareCommonAlpha"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/Sym/AlphaShareCommon.lean#L125-L131">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.shareCommonAlpha"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">shareCommonAlpha</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">e</span> : <a href="../../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaShareCommonM">AlphaShareCommonM</a> <a href="../../.././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><p>Similar to <code>shareCommon</code>, but handles alpha-equivalence.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Meta.Sym.shareCommonAlpha" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Meta.Sym.shareCommonAlphaInc"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Meta/Sym/AlphaShareCommon.lean#L150-L181">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.shareCommonAlphaInc"><span class="name">Lean</span>.<span class="name">Meta</span>.<span class="name">Sym</span>.<span class="name">shareCommonAlphaInc</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">e</span> : <a href="../../.././Lean/Expr.html#Lean.Expr">Expr</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaShareCommonM">AlphaShareCommonM</a> <a href="../../.././Lean/Expr.html#Lean.Expr">Expr</a></span></div></div><p>Incremental variant of <code><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.shareCommonAlpha">shareCommonAlpha</a></code> for expressions constructed from already-shared subterms.</p><p>Use this when an expression <code>e</code> was produced by a Lean API (e.g., <code>inferType</code>, <code>mkApp4</code>) that
does not preserve maximal sharing, but the inputs to that API were already maximally shared.
In this case, only the newly constructed nodes need processing—the shared subterms can be
looked up directly in the <code><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.AlphaShareCommonM">AlphaShareCommonM</a></code> state without building a temporary hashmap.</p><p>Unlike <code><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.shareCommonAlpha">shareCommonAlpha</a></code>, this function does not use a local <code><a href="../../.././Std/Data/HashMap/Basic.html#Std.HashMap">Std.HashMap</a> ExprPtr Expr</code> to
track visited nodes. This is more efficient when the number of new (unshared) nodes is small,
which is the common case when wrapping API calls that build a few constructor nodes around
shared inputs.</p><p>Example:</p><pre><code>-- `a` and `b` are already maximally shared
let result := mkApp2 f a b  -- result is not maximally shared
let result ← <a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.shareCommonAlphaInc">shareCommonAlphaInc</a> result -- efficiently restore sharing
</code></pre><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#Lean.Meta.Sym.shareCommonAlphaInc">Lean.Meta.Sym.shareCommonAlphaInc</a> <span class="fn">e</span></span> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../../.././Lean/Meta/Sym/AlphaShareCommon.html#_private.Lean.Meta.Sym.AlphaShareCommon.0.Lean.Meta.Sym.shareCommonAlphaInc.go">Lean.Meta.Sym.shareCommonAlphaInc.go✝</a> <span class="fn">e</span></span></li></ul></details><details id="instances-for-list-Lean.Meta.Sym.shareCommonAlphaInc" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>