<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href=".././style.css"></link><link rel="icon" href=".././favicon.svg"></link><link rel="mask-icon" href=".././favicon.svg" color="#000000"></link><link rel="prefetch" href=".././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Hygiene</title><script defer="true" src=".././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT=".././";</script><script>const MODULE_NAME="Lean.Hygiene";</script><script type="module" src=".././jump-src.js"></script><script type="module" src=".././search.js"></script><script type="module" src=".././expand-nav.js"></script><script type="module" src=".././how-about.js"></script><script type="module" src=".././instances.js"></script><script type="module" src=".././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Hygiene</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href=".././Lean/Data/Format.html">Lean.Data.Format</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Hygiene" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Unhygienic.Context"><span class="name">Lean</span>.<span class="name">Unhygienic</span>.<span class="name">Context</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Unhygienic"><span class="name">Lean</span>.<span class="name">Unhygienic</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Unhygienic.instMonadQuotation"><span class="name">Lean</span>.<span class="name">Unhygienic</span>.<span class="name">instMonadQuotation</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Unhygienic.run"><span class="name">Lean</span>.<span class="name">Unhygienic</span>.<span class="name">run</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.pp.sanitizeNames"><span class="name">Lean</span>.<span class="name">pp</span>.<span class="name">sanitizeNames</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.getSanitizeNames"><span class="name">Lean</span>.<span class="name">getSanitizeNames</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.NameSanitizerState"><span class="name">Lean</span>.<span class="name">NameSanitizerState</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.sanitizeName"><span class="name">Lean</span>.<span class="name">sanitizeName</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.sanitizeSyntax"><span class="name">Lean</span>.<span class="name">sanitizeSyntax</span></a></div></nav><main>
<div class="mod_doc"><p>Remark: <code>MonadQuotation</code> class is part of the <code><a href=".././Init.html">Init</a></code> package and loaded by default since it is used in the builtin command <code>macro</code>.</p></div><div class="decl" id="Lean.Unhygienic.Context"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L16-L18">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.Unhygienic.Context"><span class="name">Lean</span>.<span class="name">Unhygienic</span>.<span class="name">Context</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.Unhygienic.Context.mk"><li id="Lean.Unhygienic.Context.ref" class="structure_field"><div class="structure_field_info">ref : <a href=".././Init/Prelude.html#Lean.Syntax">Syntax</a></div></li><li id="Lean.Unhygienic.Context.scope" class="structure_field"><div class="structure_field_info">scope : <a href=".././Init/Prelude.html#Lean.MacroScope">MacroScope</a></div></li></ul><details id="instances-for-list-Lean.Unhygienic.Context" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Unhygienic"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L20-L34">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.Unhygienic"><span class="name">Lean</span>.<span class="name">Unhygienic</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><p>Simplistic MonadQuotation that does not guarantee globally fresh names, that
is, between different runs of this or other MonadQuotation implementations.
It is only safe if the syntax quotations do not introduce bindings around
antiquotations, and if references to globals are prefixed with <code>_root_.</code>
(which is not allowed to refer to a local variable)
<code><a href=".././Lean/Hygiene.html#Lean.Unhygienic">Unhygienic</a></code> can also be seen as a model implementation of <code>MonadQuotation</code>
(since it is completely hygienic as long as it is &quot;run&quot; only once and can
assume that there are no other implementations in use, as is the case for the
elaboration monads that carry their macro scope state through the entire
processing of a file). It uses the state monad to query and allocate the
next macro scope, and uses the reader monad to store the stack of scopes
corresponding to <code>withFreshMacroScope</code> calls.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/Hygiene.html#Lean.Unhygienic">Lean.Unhygienic</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/Prelude.html#ReaderT">ReaderT</a> <a href=".././Lean/Hygiene.html#Lean.Unhygienic.Context">Lean.Unhygienic.Context</a> <span class="fn">(<a href=".././Init/Control/State.html#StateM">StateM</a> <a href=".././Init/Prelude.html#Lean.MacroScope">Lean.MacroScope</a>)</span></span></li></ul></details><details id="instances-for-list-Lean.Unhygienic" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Unhygienic.instMonadQuotation"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L36-L43">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.Unhygienic.instMonadQuotation"><span class="name">Lean</span>.<span class="name">Unhygienic</span>.<span class="name">instMonadQuotation</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Prelude.html#Lean.MonadQuotation">MonadQuotation</a> <a href=".././Lean/Hygiene.html#Lean.Unhygienic">Unhygienic</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Unhygienic.run"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L45-L46">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.Unhygienic.run"><span class="name">Lean</span>.<span class="name">Unhygienic</span>.<span class="name">run</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Lean/Hygiene.html#Lean.Unhygienic">Unhygienic</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">α</span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">x</span>.<a href=".././Lean/Hygiene.html#Lean.Unhygienic.run">run</a></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Control/State.html#StateT.run'">StateT.run'</a> <span class="fn">(<span class="fn">x</span> <a href=".././Lean/Hygiene.html#Lean.Unhygienic.Context.mk">{</a> <span class="fn">ref</span> := <a href=".././Init/Prelude.html#Lean.Syntax.missing">Lean.Syntax.missing</a>, <span class="fn">scope</span> := <a href=".././Init/Prelude.html#Lean.firstFrontendMacroScope">Lean.firstFrontendMacroScope</a> <a href=".././Lean/Hygiene.html#Lean.Unhygienic.Context.mk">}</a>)</span>
    (<a href=".././Init/Prelude.html#Lean.firstFrontendMacroScope">Lean.firstFrontendMacroScope</a> <a href=".././Init/Prelude.html#HAdd.hAdd">+</a> <span class="fn">1</span>)</span></li></ul></details><details id="instances-for-list-Lean.Unhygienic.run" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.pp.sanitizeNames"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L70-L74">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.pp.sanitizeNames"><span class="name">Lean</span>.<span class="name">pp</span>.<span class="name">sanitizeNames</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div></div></div><div class="decl" id="Lean.getSanitizeNames"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L76-L76">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.getSanitizeNames"><span class="name">Lean</span>.<span class="name">getSanitizeNames</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">o</span> : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href=".././Init/Prelude.html#Bool">Bool</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Hygiene.html#Lean.getSanitizeNames">Lean.getSanitizeNames</a> <span class="fn">o</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Lean/Data/Options.html#Lean.Option.get">Lean.Option.get</a> <span class="fn">o</span> <a href=".././Lean/Hygiene.html#Lean.pp.sanitizeNames">Lean.pp.sanitizeNames</a></span></li></ul></details><details id="instances-for-list-Lean.getSanitizeNames" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.NameSanitizerState"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L78-L83">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.NameSanitizerState"><span class="name">Lean</span>.<span class="name">NameSanitizerState</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href=".././foundational_types.html">Type</a></div></div><ul class="structure_fields" id="Lean.NameSanitizerState.mk"><li id="Lean.NameSanitizerState.options" class="structure_field"><div class="structure_field_info">options : <a href=".././Lean/Data/Options.html#Lean.Options">Options</a></div></li><li id="Lean.NameSanitizerState.nameStem2Idx" class="structure_field"><div class="structure_field_info">nameStem2Idx : <span class="fn"><a href=".././Lean/Data/NameMap/Basic.html#Lean.NameMap">NameMap</a> <a href=".././Init/Prelude.html#Nat">Nat</a></span></div><div class="structure_field_doc"><p><code>x</code> ~&gt; 2 if we're already using <code>x✝</code>, <code>x✝¹</code></p></div></li><li id="Lean.NameSanitizerState.userName2Sanitized" class="structure_field"><div class="structure_field_info">userName2Sanitized : <span class="fn"><a href=".././Lean/Data/NameMap/Basic.html#Lean.NameMap">NameMap</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div><div class="structure_field_doc"><p><code>x._hyg...</code> ~&gt; <code>x✝</code></p></div></li></ul><details id="instances-for-list-Lean.NameSanitizerState" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.sanitizeName"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L94-L100">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.sanitizeName"><span class="name">Lean</span>.<span class="name">sanitizeName</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">userName</span> : <a href=".././Init/Prelude.html#Lean.Name">Name</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Control/State.html#StateM">StateM</a> <a href=".././Lean/Hygiene.html#Lean.NameSanitizerState">NameSanitizerState</a> <a href=".././Init/Prelude.html#Lean.Name">Name</a></span></div></div><p>Erase macro scopes from <code>userName</code> and add &quot;tombstone&quot; + superscript (or <code>._hyg</code>).</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.sanitizeName" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.sanitizeSyntax"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/Hygiene.lean#L111-L115">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/Hygiene.html#Lean.sanitizeSyntax"><span class="name">Lean</span>.<span class="name">sanitizeSyntax</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">stx</span> : <a href=".././Init/Prelude.html#Lean.Syntax">Syntax</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/Control/State.html#StateM">StateM</a> <a href=".././Lean/Hygiene.html#Lean.NameSanitizerState">NameSanitizerState</a> <a href=".././Init/Prelude.html#Lean.Syntax">Syntax</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/Hygiene.html#Lean.sanitizeSyntax">Lean.sanitizeSyntax</a> <span class="fn">stx</span></span> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <a href=".././Init/Prelude.html#MonadState.get">get</a>
  <a href=".././Init/Prelude.html#ite">if</a> <span class="fn"><a href=".././Lean/Hygiene.html#Lean.getSanitizeNames">Lean.getSanitizeNames</a> <span class="fn"><span class="fn">__do_lift</span>.<a href=".././Lean/Hygiene.html#Lean.NameSanitizerState.options">options</a></span></span> <a href=".././Init/Prelude.html#Eq">=</a> <a href=".././Init/Prelude.html#Bool.true">true</a> <a href=".././Init/Prelude.html#ite">then</a> <span class="fn"><a href=".././Lean/Hygiene.html#_private.Lean.Hygiene.0.Lean.sanitizeSyntaxAux">Lean.sanitizeSyntaxAux✝</a> <span class="fn">stx</span></span> <a href=".././Init/Prelude.html#ite">else</a> <span class="fn"><a href=".././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">stx</span></span></span></li></ul></details><details id="instances-for-list-Lean.sanitizeSyntax" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src=".././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>