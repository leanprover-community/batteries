<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Lean.Language.Basic</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Lean.Language.Basic";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Basic</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Lean/Parser/Types.html">Lean.Parser.Types</a></li><li><a href="../.././Lean/Util/Trace.html">Lean.Util.Trace</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.Language.Basic" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.Diagnostics"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.instInhabitedDiagnostics"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">instInhabitedDiagnostics</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.instInhabitedDiagnostics.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">instInhabitedDiagnostics</span>.<span class="name">default</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.Diagnostics.empty"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span>.<span class="name">empty</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshot.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshot</span>.<span class="name">default</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.ReportingRange"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">ReportingRange</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.instInhabitedReportingRange.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">instInhabitedReportingRange</span>.<span class="name">default</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.instInhabitedReportingRange"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">instInhabitedReportingRange</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">ReportingRange</span>.<span class="name">ofOptionInheriting</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.defaultReportingRange"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">defaultReportingRange</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instNonemptySnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instNonemptySnapshotTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshotTask.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTask</span>.<span class="name">default</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTask</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.ofIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">ofIO</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.finished"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">finished</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.map"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">map</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.bindIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">bindIO</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.get"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">get</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.get?"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">get?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SyntaxGuarded"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SyntaxGuarded</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotBundle"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotBundle</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshotTree.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTree</span>.<span class="name">default</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTree</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instTypeNameSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instTypeNameSnapshotTree</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.ToSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ToSnapshotTree</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instToSnapshotTreeSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeSnapshotTree</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instToSnapshotTreeOption"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeOption</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTask.cancelRec"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">cancelRec</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotLeaf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotLeaf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedSnapshotLeaf.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotLeaf</span>.<span class="name">default</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instTypeNameSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instTypeNameSnapshotLeaf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instToSnapshotTreeSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeSnapshotLeaf</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.DynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instToSnapshotTreeDynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeDynamicSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.DynamicSnapshot.ofTyped"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span>.<span class="name">ofTyped</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.DynamicSnapshot.toTyped?"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span>.<span class="name">toTyped?</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instInhabitedDynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedDynamicSnapshot</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.forM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">forM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.foldM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">foldM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.printMessageEndPos"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">printMessageEndPos</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.maxErrors"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">maxErrors</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.runAndReport"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">runAndReport</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.getAll"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">getAll</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.SnapshotTree.waitAll"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">waitAll</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.ProcessingContext"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingContext</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.ProcessingT"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingT</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.ProcessingM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingM</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.instMonadLiftProcessingMProcessingTIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instMonadLiftProcessingMProcessingTIO</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.Snapshot.Diagnostics.ofMessageLog"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span>.<span class="name">ofMessageLog</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.diagnosticsOfHeaderError"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">diagnosticsOfHeaderError</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.withHeaderExceptions"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">withHeaderExceptions</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.Language.mkIncrementalProcessor"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">mkIncrementalProcessor</span></a></div></nav><main>
<div class="decl" id="Lean.Language.Snapshot.Diagnostics"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L23-L40">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p><code>MessageLog</code> with interactive diagnostics.</p><p>Can be created using <code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.empty">Diagnostics.empty</a></code> or <code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.ofMessageLog">Diagnostics.ofMessageLog</a></code>.</p><ul class="structure_fields" id="_private.Lean.Language.Basic.0.Lean.Language.Snapshot.Diagnostics.mk"><li id="Lean.Language.Snapshot.Diagnostics.msgLog" class="structure_field"><div class="structure_field_info">msgLog : <a href="../.././Lean/Message.html#Lean.MessageLog">MessageLog</a></div><div class="structure_field_doc"><p>Non-interactive message log.</p></div></li><li id="Lean.Language.Snapshot.Diagnostics.interactiveDiagsRef?" class="structure_field"><div class="structure_field_info">interactiveDiagsRef? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href="../.././Init/System/IO.html#IO.Ref">IO.Ref</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Dynamic.html#Dynamic">Dynamic</a>)</span>)</span></span></div><div class="structure_field_doc"><p>Dynamic mutable slot usable by the language server for memorizing interactive diagnostics. If
<code>none</code>, interactive diagnostics are not remembered, which should only be used for messages not
containing any interactive elements as client-side state will be lost on recreating a diagnostic.</p><p>See also section &quot;Communication&quot; in Lean/Server/README.md.</p></div></li></ul><details id="instances-for-list-Lean.Language.Snapshot.Diagnostics" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot.instInhabitedDiagnostics"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L40-L40">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.instInhabitedDiagnostics"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">instInhabitedDiagnostics</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Diagnostics</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.instInhabitedDiagnostics">Lean.Language.Snapshot.instInhabitedDiagnostics</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.instInhabitedDiagnostics.default">Lean.Language.Snapshot.instInhabitedDiagnostics.default</a> <a href="../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot.instInhabitedDiagnostics.default"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L40-L40">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.instInhabitedDiagnostics.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">instInhabitedDiagnostics</span>.<span class="name">default</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Diagnostics</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.instInhabitedDiagnostics.default">Lean.Language.Snapshot.instInhabitedDiagnostics.default</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#_private.Lean.Language.Basic.0.Lean.Language.Snapshot.Diagnostics.mk">{</a> <span class="fn">msgLog</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">interactiveDiagsRef?</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a> <a href="../.././Lean/Language/Basic.html#_private.Lean.Language.Basic.0.Lean.Language.Snapshot.Diagnostics.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.Snapshot.instInhabitedDiagnostics.default" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot.Diagnostics.empty"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L42-L46">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.empty"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span>.<span class="name">empty</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Diagnostics</a></div></div><p>The empty set of diagnostics.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.empty">Lean.Language.Snapshot.Diagnostics.empty</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#_private.Lean.Language.Basic.0.Lean.Language.Snapshot.Diagnostics.mk">{</a> <span class="fn">msgLog</span> := <a href="../.././Lean/Message.html#Lean.MessageLog.empty">Lean.MessageLog.empty</a>, <span class="fn">interactiveDiagsRef?</span> := <a href="../.././Init/Prelude.html#Option.none">none</a> <a href="../.././Lean/Language/Basic.html#_private.Lean.Language.Basic.0.Lean.Language.Snapshot.Diagnostics.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.Snapshot.Diagnostics.empty" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L48-L70">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>The base class of all snapshots: all the generic information the language server needs about a
snapshot.</p><ul class="structure_fields" id="Lean.Language.Snapshot.mk"><li id="Lean.Language.Snapshot.desc" class="structure_field"><div class="structure_field_info">desc : <a href="../.././Init/Prelude.html#String">String</a></div><div class="structure_field_doc"><p>Debug description shown by <code>trace.Elab.snapshotTree</code>, defaults to the caller's decl name.</p></div></li><li id="Lean.Language.Snapshot.diagnostics" class="structure_field"><div class="structure_field_info">diagnostics : <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Diagnostics</a></div><div class="structure_field_doc"><p>The messages produced by this step. The union of message logs of all finished snapshots is
reported to the user.</p></div></li><li id="Lean.Language.Snapshot.infoTree?" class="structure_field"><div class="structure_field_info">infoTree? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Elab.InfoTree</a></span></div><div class="structure_field_doc"><p>General elaboration metadata produced by this step.</p></div></li><li id="Lean.Language.Snapshot.traces" class="structure_field"><div class="structure_field_info">traces : <a href="../.././Lean/Util/Trace.html#Lean.TraceState">TraceState</a></div><div class="structure_field_doc"><p>Trace data produced by this step. Currently used only by <code>trace.profiler.output</code>, otherwise we
depend on the elaborator adding traces to <code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.diagnostics">diagnostics</a></code> eventually.</p></div></li><li id="Lean.Language.Snapshot.isFatal" class="structure_field"><div class="structure_field_info">isFatal : <a href="../.././Init/Prelude.html#Bool">Bool</a></div><div class="structure_field_doc"><p>Whether it should be indicated to the user that a fatal error (which should be part of
<code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.diagnostics">diagnostics</a></code>) occurred that prevents processing of the remainder of the file.</p></div></li></ul><details id="instances-for-list-Lean.Language.Snapshot" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshot"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L70-L70">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshot">Lean.Language.instInhabitedSnapshot</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshot.default">Lean.Language.instInhabitedSnapshot.default</a> <a href="../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshot.default"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L70-L70">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshot.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshot</span>.<span class="name">default</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshot.default">Lean.Language.instInhabitedSnapshot.default</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.mk">{</a> <span class="fn">desc</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">diagnostics</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">infoTree?</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">traces</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">isFatal</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.instInhabitedSnapshot.default" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.ReportingRange"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L72-L80">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">ReportingRange</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Range that is marked as being processed by the server while a task is running.</p><ul class="constructors"><li class="constructor" id="Lean.Language.SnapshotTask.ReportingRange.inherit">inherit : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a><div class="inductive_ctor_doc"><p>Inherit range from outer task if any, or else the entire file.</p></div></li><li class="constructor" id="Lean.Language.SnapshotTask.ReportingRange.some">some<span class="decl_args">
<span class="fn">(<span class="fn">range</span> : <a href="../.././Lean/Syntax.html#Lean.Syntax.Range">Syntax.Range</a>)</span></span>
 : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a><div class="inductive_ctor_doc"><p>Use given range.</p></div></li><li class="constructor" id="Lean.Language.SnapshotTask.ReportingRange.skip">skip : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a><div class="inductive_ctor_doc"><p>Do not mark as being processed. Child nodes are still visited.</p></div></li></ul><details id="instances-for-list-Lean.Language.SnapshotTask.ReportingRange" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.instInhabitedReportingRange.default"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L80-L80">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.instInhabitedReportingRange.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">instInhabitedReportingRange</span>.<span class="name">default</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.instInhabitedReportingRange.default">Lean.Language.SnapshotTask.instInhabitedReportingRange.default</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.inherit">Lean.Language.SnapshotTask.ReportingRange.inherit</a></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.instInhabitedReportingRange.default" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.instInhabitedReportingRange"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L80-L80">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.instInhabitedReportingRange"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">instInhabitedReportingRange</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.instInhabitedReportingRange">Lean.Language.SnapshotTask.instInhabitedReportingRange</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.instInhabitedReportingRange.default">Lean.Language.SnapshotTask.instInhabitedReportingRange.default</a> <a href="../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L82-L88">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">ReportingRange</span>.<span class="name">ofOptionInheriting</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Syntax.html#Lean.Syntax.Range">Syntax.Range</a></span> → <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a></span></div></div><p>Constructs a reporting range by replacing a missing range with <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.inherit">inherit</a></code>, which is a reasonable
default to ensure that a range is shown in all cases.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting">Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn">range</span>)</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.some">Lean.Language.SnapshotTask.ReportingRange.some</a> <span class="fn">range</span></span></li><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting">Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting</a> <a href="../.././Init/Prelude.html#Option.none">none</a></span> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.inherit">Lean.Language.SnapshotTask.ReportingRange.inherit</a></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.defaultReportingRange"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L90-L95">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.defaultReportingRange"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">defaultReportingRange</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">stx?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a></div></div><p>Yields the default reporting range of a <code>Syntax</code>, which is just the <code>canonicalOnly</code> range
of the syntax if any, or <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.inherit">inherit</a></code> otherwise.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.defaultReportingRange">Lean.Language.SnapshotTask.defaultReportingRange</a> <span class="fn">stx?</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting">Lean.Language.SnapshotTask.ReportingRange.ofOptionInheriting</a> <span class="fn">(<span class="fn"><span class="fn">stx?</span>.<a href="../.././Init/Data/Option/Basic.html#Option.bind">bind</a></span> <span class="fn">fun (<span class="fn">x</span> : <a href="../.././Init/Prelude.html#Lean.Syntax">Lean.Syntax</a>) =&gt; <span class="fn"><span class="fn"><span class="fn">x</span>.<a href="../.././Lean/Syntax.html#Lean.Syntax.getRange?">getRange?</a></span> <a href="../.././Init/Prelude.html#Bool.true">true</a></span></span>)</span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.defaultReportingRange" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L97-L123">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>A task producing some snapshot type (usually a subclass of <code><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a></code>).</p><ul class="structure_fields" id="Lean.Language.SnapshotTask.mk"><li id="Lean.Language.SnapshotTask.stx?" class="structure_field"><div class="structure_field_info">stx? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></span></div><div class="structure_field_doc"><p><code>Syntax</code> processed by this <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a></code>.
The <code>Syntax</code> is used by the language server to determine whether to force this <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a></code>
when a request is made.
In general, the elaborator retains the following invariant:
If <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.stx?">stx?</a></code> is <code>none</code>, then this snapshot task (and all of its children) do not contain <code>InfoTree</code>
information that can be used in the language server, and so the language server will ignore it
when it is looking for an <code>InfoTree</code>.
Nonetheless, if <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.stx?">stx?</a></code> is <code>none</code>, then this snapshot task (and any of its children) may still
contain message log information.</p></div></li><li id="Lean.Language.SnapshotTask.reportingRange" class="structure_field"><div class="structure_field_info">reportingRange : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a></div><div class="structure_field_doc"><p>Range that is marked as being processed by the server while the task is running.</p></div></li><li id="Lean.Language.SnapshotTask.cancelTk?" class="structure_field"><div class="structure_field_info">cancelTk? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span></div><div class="structure_field_doc"><p>Cancellation token that can be set by the server to cancel the task when it detects the results
are not needed anymore.</p></div></li><li id="Lean.Language.SnapshotTask.task" class="structure_field"><div class="structure_field_info">task : <span class="fn"><a href="../.././Init/Core.html#Task">Task</a> <span class="fn">α</span></span></div><div class="structure_field_doc"><p>Underlying task producing the snapshot.</p></div></li></ul><details id="instances-for-list-Lean.Language.SnapshotTask" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instNonemptySnapshotTask"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L123-L123">source</a></div><div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instNonemptySnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instNonemptySnapshotTask</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α✝</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">α✝</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Nonempty">Nonempty</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α✝</span>)</span></span></div></div></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshotTask.default"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L123-L123">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTask.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTask</span>.<span class="name">default</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">a✝</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">a✝</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">a✝</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTask.default">Lean.Language.instInhabitedSnapshotTask.default</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.mk">{</a> <span class="fn">stx?</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">reportingRange</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">cancelTk?</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">task</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.instInhabitedSnapshotTask.default" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshotTask"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L123-L123">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTask"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTask</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">a✝</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">a✝</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">a✝</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTask">Lean.Language.instInhabitedSnapshotTask</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTask.default">Lean.Language.instInhabitedSnapshotTask.default</a> <a href="../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.ofIO"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L125-L132">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ofIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">ofIO</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">stx?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cancelTk?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">reportingRange</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a> := <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.defaultReportingRange">defaultReportingRange</a> <span class="fn">stx?</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">act</span> : <span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α</span>)</span></span></div></div><p>Creates a snapshot task from the syntax processed by the task and a <code><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a></code> action.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.ofIO" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.finished"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L134-L140">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.finished"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">finished</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">stx?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">a</span> : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α</span></span></div></div><p>Creates a finished snapshot task.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.finished">Lean.Language.SnapshotTask.finished</a> <span class="fn">stx?</span> <span class="fn">a</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.mk">{</a> <span class="fn">stx?</span> := <span class="fn">stx?</span>, <span class="fn">reportingRange</span> := <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange.skip">Lean.Language.SnapshotTask.ReportingRange.skip</a>, <span class="fn">cancelTk?</span> := <a href="../.././Init/Prelude.html#Option.none">none</a>,
    <span class="fn">task</span> := <a href="../.././Init/Core.html#Task.pure">{</a> <span class="fn">get</span> := <span class="fn">a</span> <a href="../.././Init/Core.html#Task.pure">}</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.finished" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.map"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L142-L145">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.map"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">map</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">t</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><span class="fn">α</span> → <span class="fn">β</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">stx?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></span> := <span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.stx?">stx?</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">reportingRange</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a> := <span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.reportingRange">reportingRange</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">sync</span> : <a href="../.././Init/Prelude.html#Bool">Bool</a> := <a href="../.././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">β</span></span></div></div><p>Transforms a task's output without changing the processed syntax.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.map">map</a></span> <span class="fn">f</span> <span class="fn">stx?</span> <span class="fn">reportingRange</span> <span class="fn">sync</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.mk">{</a> <span class="fn">stx?</span> := <span class="fn">stx?</span>, <span class="fn">reportingRange</span> := <span class="fn">reportingRange</span>, <span class="fn">cancelTk?</span> := <span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.cancelTk?">cancelTk?</a></span>,
    <span class="fn">task</span> := <span class="fn"><a href="../.././Init/Core.html#Task.map">Task.map</a> <span class="fn">f</span> <span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.task">task</a></span> <a href="../.././Init/Core.html#Task.Priority.default">Task.Priority.default</a> <span class="fn">sync</span></span> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.map" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.bindIO"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L147-L158">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.bindIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">bindIO</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α </span><span class="fn">β</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">t</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">act</span> : <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">β</span>)</span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">stx?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></span> := <span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.stx?">stx?</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">reportingRange</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.ReportingRange">ReportingRange</a> := <span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.reportingRange">reportingRange</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">cancelTk?</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Init/System/IO.html#IO.CancelToken">IO.CancelToken</a></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">sync</span> : <a href="../.././Init/Prelude.html#Bool">Bool</a> := <a href="../.././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">β</span>)</span></span></div></div><p>Chains two snapshot tasks. The processed syntax and the reporting range are taken from the first
task if not specified; the processed syntax and the reporting range of the second task are
discarded. The cancellation tokens of both tasks are discarded. They are replaced with the given
token if any.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.bindIO" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.get"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L160-L162">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.get"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">get</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">t</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">α</span></div></div><p>Synchronously waits on the result of the task.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.get">get</a></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.task">task</a></span>.<a href="../.././Init/Core.html#Task.get">get</a></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.get" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.get?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L164-L166">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.get?"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">get?</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">t</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">α</span>)</span></span></div></div><p>Returns task result if already finished or else <code>none</code>.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.get?">get?</a></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href="../.././Init/System/IO.html#IO.hasFinished">IO.hasFinished</a> <span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.task">task</a></span></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> (<a href="../.././Init/Prelude.html#ite">if</a> <span class="fn">__do_lift</span> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Init/Prelude.html#Bool.true">true</a> <a href="../.././Init/Prelude.html#ite">then</a> <span class="fn"><a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn"><span class="fn"><span class="fn">t</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.task">task</a></span>.<a href="../.././Init/Core.html#Task.get">get</a></span></span> <a href="../.././Init/Prelude.html#ite">else</a> <a href="../.././Init/Prelude.html#Option.none">none</a>)</span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTask.get?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SyntaxGuarded"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L168-L175">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SyntaxGuarded"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SyntaxGuarded</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Arbitrary value paired with a syntax that should be inspected when considering the value for reuse.</p><ul class="structure_fields" id="Lean.Language.SyntaxGuarded.mk"><li id="Lean.Language.SyntaxGuarded.stx" class="structure_field"><div class="structure_field_info">stx : <a href="../.././Init/Prelude.html#Lean.Syntax">Syntax</a></div><div class="structure_field_doc"><p>Syntax to be inspected for reuse.</p></div></li><li id="Lean.Language.SyntaxGuarded.val" class="structure_field"><div class="structure_field_info">val : <span class="fn">α</span></div><div class="structure_field_doc"><p>Potentially reusable value.</p></div></li></ul><details id="instances-for-list-Lean.Language.SyntaxGuarded" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotBundle"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L177-L199">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotBundle"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotBundle</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Pair of (optional) old snapshot task usable for incremental reuse and new snapshot promise for
incremental reporting. Inside the elaborator, we build snapshots by carrying such bundles and then
checking if we can reuse <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotBundle.old?">old?</a></code> if set or else redoing the corresponding elaboration step. In either
case, we derive new bundles for nested snapshots, if any, and finally <code>resolve</code> <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotBundle.new">new</a></code> to the result.</p><p>Note that failing to <code>resolve</code> a created promise will block the language server indefinitely!
We use <code>withAlwaysResolvedPromise</code>/<code>withAlwaysResolvedPromises</code> to ensure this doesn't happen.</p><p>In the future, the 1-element history <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotBundle.old?">old?</a></code> may be replaced with a global cache indexed by strong
hashes but the promise will still need to be passed through the elaborator.</p><ul class="structure_fields" id="Lean.Language.SnapshotBundle.mk"><li id="Lean.Language.SnapshotBundle.old?" class="structure_field"><div class="structure_field_info">old? : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SyntaxGuarded">SyntaxGuarded</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α</span>)</span>)</span></span></div><div class="structure_field_doc"><p>Snapshot task of corresponding elaboration in previous document version if any, paired with its
old syntax to be considered for reuse. Should be set to <code>none</code> as soon as reuse can be ruled out.</p></div></li><li id="Lean.Language.SnapshotBundle.new" class="structure_field"><div class="structure_field_info">new : <span class="fn"><a href="../.././Init/System/Promise.html#IO.Promise">IO.Promise</a> <span class="fn">α</span></span></div><div class="structure_field_doc"><p>Promise of snapshot value for the current document. When resolved, the language server will
report its result even before the current elaborator invocation has finished.</p></div></li></ul><details id="instances-for-list-Lean.Language.SnapshotBundle" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L201-L211">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Tree of snapshots where each snapshot comes with an array of asynchronous further subtrees. Used
for asynchronously collecting information about the entirety of snapshots in the language server.
The involved tasks may form a DAG on the <code><a href="../.././Init/Core.html#Task">Task</a></code> dependency level but this is not captured by this
data structure.</p><ul class="structure_fields" id="Lean.Language.SnapshotTree.mk"><li id="Lean.Language.SnapshotTree.element" class="structure_field"><div class="structure_field_info">element : <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a></div><div class="structure_field_doc"><p>The immediately available element of the snapshot tree node.</p></div></li><li id="Lean.Language.SnapshotTree.children" class="structure_field"><div class="structure_field_info">children : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a>)</span></span></div><div class="structure_field_doc"><p>The asynchronously available children of the snapshot tree node.</p></div></li></ul><details id="instances-for-list-Lean.Language.SnapshotTree" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshotTree.default"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L211-L211">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTree.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTree</span>.<span class="name">default</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTree.default">Lean.Language.instInhabitedSnapshotTree.default</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">{</a> <span class="fn">element</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a>, <span class="fn">children</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.instInhabitedSnapshotTree.default" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshotTree"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L211-L211">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotTree</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTree">Lean.Language.instInhabitedSnapshotTree</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotTree.default">Lean.Language.instInhabitedSnapshotTree.default</a> <a href="../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.instTypeNameSnapshotTree"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L211-L211">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instTypeNameSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instTypeNameSnapshotTree</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Dynamic.html#TypeName">TypeName</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instTypeNameSnapshotTree">Lean.Language.instTypeNameSnapshotTree</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.inst._@.Lean.Language.Basic.3470488393._hygCtx._hyg.39">Lean.Language.inst✝</a></li></ul></details></div></div><div class="decl" id="Lean.Language.ToSnapshotTree"><div class="class"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L213-L218">source</a></div><div class="decl_header"><span class="decl_kind">class</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ToSnapshotTree</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Helper class for projecting a heterogeneous hierarchy of snapshot classes to a homogeneous
representation.</p><ul class="structure_fields" id="Lean.Language.ToSnapshotTree.mk"><li id="Lean.Language.ToSnapshotTree.toSnapshotTree" class="structure_field"><div class="structure_field_info">toSnapshotTree : <span class="fn"><span class="fn">α</span> → <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a></span></div><div class="structure_field_doc"><p>Transforms a language-specific snapshot to a homogeneous snapshot tree.</p></div></li></ul><details class="instances"><summary>Instances</summary><ul id="instances-list-Lean.Language.ToSnapshotTree" class="instances-list"></ul></details></div></div><div class="decl" id="Lean.Language.instToSnapshotTreeSnapshotTree"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L221-L222">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeSnapshotTree"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeSnapshotTree</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">ToSnapshotTree</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeSnapshotTree">Lean.Language.instToSnapshotTreeSnapshotTree</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.mk">{</a> <span class="fn">toSnapshotTree</span> := <span class="fn">fun (<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">Lean.Language.SnapshotTree</a>) =&gt; <span class="fn">s</span></span> <a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.instToSnapshotTreeOption"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L224-L227">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeOption"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeOption</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">ToSnapshotTree</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">ToSnapshotTree</a> <span class="fn">(<a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">α</span>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeOption">Lean.Language.instToSnapshotTreeOption</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.mk">{</a>     <span class="fn">toSnapshotTree</span> := <span class="fn">fun (<span class="fn">x</span> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">α</span></span>) =&gt;
      <span class="fn">match <span class="fn">x</span> with
      | <span class="fn"><a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn">a</span></span> =&gt; <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.toSnapshotTree">Lean.Language.toSnapshotTree</a> <span class="fn">a</span></span>
      | <a href="../.././Init/Prelude.html#Option.none">none</a> =&gt; <a href="../.././Init/Prelude.html#Inhabited.default">default</a></span></span> <a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTask.cancelRec"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L229-L235">source</a></div><div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.cancelRec"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTask</span>.<span class="name">cancelRec</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">ToSnapshotTree</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">t</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask">SnapshotTask</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Recursively triggers all <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTask.cancelTk?">SnapshotTask.cancelTk?</a></code> in the reachable tree, asynchronously.</p></div></div><div class="decl" id="Lean.Language.SnapshotLeaf"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L237-L239">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotLeaf</span></a></span><span class="decl_extends">extends</span> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Snapshot type without child nodes.</p><ul class="structure_fields" id="Lean.Language.SnapshotLeaf.mk"><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.desc">desc</a> : <a href="../.././Init/Prelude.html#String">String</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.diagnostics">diagnostics</a> : <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Diagnostics</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.infoTree?">infoTree?</a> : <span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <a href="../.././Lean/Elab/InfoTree/Types.html#Lean.Elab.InfoTree">Elab.InfoTree</a></span></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.traces">traces</a> : <a href="../.././Lean/Util/Trace.html#Lean.TraceState">TraceState</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.isFatal">isFatal</a> : <a href="../.././Init/Prelude.html#Bool">Bool</a></div></li></ul><details id="instances-for-list-Lean.Language.SnapshotLeaf" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshotLeaf"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L239-L239">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotLeaf</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">SnapshotLeaf</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotLeaf">Lean.Language.instInhabitedSnapshotLeaf</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Init/Prelude.html#Inhabited.mk">{</a> <span class="fn">default</span> := <a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotLeaf.default">Lean.Language.instInhabitedSnapshotLeaf.default</a> <a href="../.././Init/Prelude.html#Inhabited.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedSnapshotLeaf.default"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L239-L239">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotLeaf.default"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedSnapshotLeaf</span>.<span class="name">default</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">SnapshotLeaf</a></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedSnapshotLeaf.default">Lean.Language.instInhabitedSnapshotLeaf.default</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf.mk">{</a> <span class="fn">toSnapshot</span> := <a href="../.././Init/Prelude.html#Inhabited.default">default</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.instInhabitedSnapshotLeaf.default" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instTypeNameSnapshotLeaf"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L239-L239">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instTypeNameSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instTypeNameSnapshotLeaf</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Dynamic.html#TypeName">TypeName</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">SnapshotLeaf</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instTypeNameSnapshotLeaf">Lean.Language.instTypeNameSnapshotLeaf</a> <a href="../.././Init/Prelude.html#Eq">=</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.inst._@.Lean.Language.Basic.3093936625._hygCtx._hyg.23">Lean.Language.inst✝</a></li></ul></details></div></div><div class="decl" id="Lean.Language.instToSnapshotTreeSnapshotLeaf"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L241-L242">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeSnapshotLeaf"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeSnapshotLeaf</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">ToSnapshotTree</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">SnapshotLeaf</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeSnapshotLeaf">Lean.Language.instToSnapshotTreeSnapshotLeaf</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.mk">{</a> <span class="fn">toSnapshotTree</span> := <span class="fn">fun (<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf">Lean.Language.SnapshotLeaf</a>) =&gt; <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">{</a> <span class="fn">element</span> := <span class="fn"><span class="fn">s</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotLeaf.toSnapshot">toSnapshot</a></span>, <span class="fn">children</span> := <a href="../.././Init/Prelude.html#List.toArray">#[</a><a href="../.././Init/Prelude.html#List.toArray">]</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">}</a></span> <a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.DynamicSnapshot"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L244-L254">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Arbitrary snapshot type, used for extensibility.</p><ul class="structure_fields" id="Lean.Language.DynamicSnapshot.mk"><li id="Lean.Language.DynamicSnapshot.val" class="structure_field"><div class="structure_field_info">val : <a href="../.././Init/Dynamic.html#Dynamic">Dynamic</a></div><div class="structure_field_doc"><p>Concrete snapshot value as <code><a href="../.././Init/Dynamic.html#Dynamic">Dynamic</a></code>.</p></div></li><li id="Lean.Language.DynamicSnapshot.tree" class="structure_field"><div class="structure_field_info">tree : <span class="fn"><a href="../.././Init/Core.html#Thunk">Thunk</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a></span></div><div class="structure_field_doc"><p>Snapshot tree retrieved from <code><a href="../.././Lean/Language/Basic.html#Lean.Language.SyntaxGuarded.val">val</a></code> before erasure. We do thunk even the first level as accessing
it too early can create some unnecessary tasks from <code><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.toSnapshotTree">toSnapshotTree</a></code> that are otherwise avoided by
<code>(sync := true)</code> when accessing only after elaboration has finished. Early access can even lead to
deadlocks when later forcing these unnecessary tasks on a starved thread pool.</p></div></li></ul><details id="instances-for-list-Lean.Language.DynamicSnapshot" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instToSnapshotTreeDynamicSnapshot"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L256-L257">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeDynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instToSnapshotTreeDynamicSnapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">ToSnapshotTree</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">DynamicSnapshot</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instToSnapshotTreeDynamicSnapshot">Lean.Language.instToSnapshotTreeDynamicSnapshot</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.mk">{</a> <span class="fn">toSnapshotTree</span> := <span class="fn">fun (<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">Lean.Language.DynamicSnapshot</a>) =&gt; <span class="fn"><span class="fn"><span class="fn">s</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.tree">tree</a></span>.<a href="../.././Init/Core.html#Thunk.get">get</a></span></span> <a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.DynamicSnapshot.ofTyped"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L259-L262">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.ofTyped"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span>.<span class="name">ofTyped</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Dynamic.html#TypeName">TypeName</a> <span class="fn">α</span></span>]</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree">ToSnapshotTree</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">val</span> : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">DynamicSnapshot</a></div></div><p>Creates a <code><a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">DynamicSnapshot</a></code> from a typed snapshot value.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.ofTyped">Lean.Language.DynamicSnapshot.ofTyped</a> <span class="fn">val</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.mk">{</a> <span class="fn">val</span> := <span class="fn"><a href="../.././Init/Dynamic.html#Dynamic.mk">Dynamic.mk</a> <span class="fn">val</span></span>, <span class="fn">tree</span> := <a href="../.././Init/Core.html#Thunk.mk">{</a> <span class="fn">fn</span> := <span class="fn">fun (<span class="fn">x</span> : <a href="../.././Init/Prelude.html#Unit">Unit</a>) =&gt; <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ToSnapshotTree.toSnapshotTree">Lean.Language.toSnapshotTree</a> <span class="fn">val</span></span></span> <a href="../.././Init/Core.html#Thunk.mk">}</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.mk">}</a></li></ul></details><details id="instances-for-list-Lean.Language.DynamicSnapshot.ofTyped" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.DynamicSnapshot.toTyped?"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L264-L267">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.toTyped?"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">DynamicSnapshot</span>.<span class="name">toTyped?</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Dynamic.html#TypeName">TypeName</a> <span class="fn">α</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">snap</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">DynamicSnapshot</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">α</span></span></div></div><p>Returns the original snapshot value if it is of the given type.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.toTyped?">Lean.Language.DynamicSnapshot.toTyped?</a> <span class="fn">α</span> <span class="fn">snap</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Dynamic.html#Dynamic.get?">Dynamic.get?</a> <span class="fn">α</span> <span class="fn"><span class="fn">snap</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot.val">val</a></span></span></li></ul></details><details id="instances-for-list-Lean.Language.DynamicSnapshot.toTyped?" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instInhabitedDynamicSnapshot"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L269-L270">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instInhabitedDynamicSnapshot"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instInhabitedDynamicSnapshot</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Inhabited">Inhabited</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.DynamicSnapshot">DynamicSnapshot</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.forM"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L272-L280">source</a></div><div class="attributes">@[specialize #[]]</div>
<div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.forM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">forM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href="../.././foundational_types.html">Type</a> u_1 → <a href="../.././foundational_types.html">Type</a> u_2</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a> → <span class="fn"><span class="fn">m</span> <a href="../.././Init/Prelude.html#PUnit">PUnit</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <a href="../.././Init/Prelude.html#PUnit">PUnit</a></span></div></div><p>Runs a tree of snapshots to conclusion, incrementally performing <code>f</code> on each snapshot in tree
preorder.</p></div></div><div class="decl" id="Lean.Language.SnapshotTree.foldM"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L282-L290">source</a></div><div class="attributes">@[specialize #[]]</div>
<div class="decl_header"><span class="decl_kind">partial def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.foldM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">foldM</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">m</span> : <span class="fn"><a href="../.././foundational_types.html">Type</a> u_1 → <a href="../.././foundational_types.html">Type</a> u_2</span>}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a> u_1}</span></span>
</span><span class="impl_arg"><span class="decl_args">
<span class="fn">[<span class="fn"><a href="../.././Init/Prelude.html#Monad">Monad</a> <span class="fn">m</span></span>]</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">f</span> : <span class="fn"><span class="fn">α</span> → <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a> → <span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">init</span> : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">m</span> <span class="fn">α</span></span></div></div><p>Runs a tree of snapshots to conclusion,
folding the function <code>f</code> over each snapshot in tree preorder.</p></div></div><div class="decl" id="Lean.Language.printMessageEndPos"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L292-L297">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.printMessageEndPos"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">printMessageEndPos</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Option for printing end position of each message in addition to start position. Used for testing
message ranges in the test suite.</p></div></div><div class="decl" id="Lean.Language.maxErrors"><div class="opaque"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L299-L303">source</a></div><div class="decl_header"><span class="decl_kind">opaque</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.maxErrors"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">maxErrors</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Data/Options.html#Lean.Option">Lean.Option</a> <a href="../.././Init/Prelude.html#Nat">Nat</a></span></div></div><p>Maximum number of errors to report.</p></div></div><div class="decl" id="Lean.Language.SnapshotTree.runAndReport"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L336-L345">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.runAndReport"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">runAndReport</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">opts</span> : <a href="../.././Lean/Data/Options.html#Lean.Options">Options</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">json</span> : <a href="../.././Init/Prelude.html#Bool">Bool</a> := <a href="../.././Init/Prelude.html#Bool.false">false</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">severityOverrides</span> : <span class="fn"><a href="../.././Lean/Data/NameMap/Basic.html#Lean.NameMap">NameMap</a> <a href="../.././Lean/Message.html#Lean.MessageSeverity">MessageSeverity</a></span> := <a href="../.././Init/Core.html#EmptyCollection.emptyCollection">∅</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Runs a tree of snapshots to conclusion and incrementally report messages on stdout. Messages are
reported in tree preorder. Returns whether any errors were reported.
This function is used by the cmdline driver; see <code>Lean.Server.FileWorker.reportSnapshots</code> for how
the language server reports snapshots asynchronously.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTree.runAndReport" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.getAll"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L347-L349">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.getAll"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">getAll</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">s</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a></span></div></div><p>Waits on and returns all snapshots in the tree.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn">s</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.getAll">getAll</a></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn">(<span class="fn"><span class="fn">s</span>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.foldM">foldM</a></span> <span class="fn">(fun (<span class="fn">x1</span> : <span class="fn"><a href="../.././Init/Prelude.html#Array">Array</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a></span>) (<span class="fn">x2</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Lean.Language.Snapshot</a>) =&gt; <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <span class="fn">(<span class="fn"><span class="fn">x1</span>.<a href="../.././Init/Prelude.html#Array.push">push</a></span> <span class="fn">x2</span>)</span></span>)</span> <a href="../.././Init/Prelude.html#List.toArray">#[</a><a href="../.././Init/Prelude.html#List.toArray">]</a>)</span>.<a href="../.././Init/Control/Id.html#Id.run">run</a></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTree.getAll" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.SnapshotTree.waitAll"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L351-L357">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.waitAll"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">SnapshotTree</span>.<span class="name">waitAll</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree">SnapshotTree</a> → <span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Init/Core.html#Task">Task</a> <a href="../.././Init/Prelude.html#Unit">Unit</a>)</span></span></span></div></div><p>Returns a task that waits on all snapshots in the tree.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">{</a> <span class="fn">element</span> := <span class="fn">element</span>, <span class="fn">children</span> := <span class="fn">children</span> <a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.mk">}</a>.<a href="../.././Lean/Language/Basic.html#Lean.Language.SnapshotTree.waitAll">waitAll</a></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Language/Basic.html#_private.Lean.Language.Basic.0.Lean.Language.SnapshotTree.waitAll.go">Lean.Language.SnapshotTree.waitAll.go✝</a> <span class="fn"><span class="fn">children</span>.<a href="../.././Init/Prelude.html#Array.toList">toList</a></span></span></li></ul></details><details id="instances-for-list-Lean.Language.SnapshotTree.waitAll" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.ProcessingContext"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L359-L360">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingContext"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingContext</span></a></span><span class="decl_extends">extends</span> <a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext">Lean.Parser.InputContext</a><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Context of an input processing invocation.</p><ul class="structure_fields" id="Lean.Language.ProcessingContext.mk"><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext.inputString">inputString</a> : <a href="../.././Init/Prelude.html#String">String</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext.fileName">fileName</a> : <a href="../.././Init/Prelude.html#String">String</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext.fileMap">fileMap</a> : <a href="../.././Lean/Data/Position.html#Lean.FileMap">FileMap</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext.endPos">endPos</a> : <a href="../.././Init/Prelude.html#String.Pos.Raw">String.Pos.Raw</a></div></li><li class="structure_field inherited_field"><div class="structure_field_info"><a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext.endPos_valid">endPos_valid</a> : <span class="fn"><span class="fn">self</span>.<a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext.endPos">endPos</a></span> <a href="../.././Init/Prelude.html#LE.le">≤</a> <span class="fn"><span class="fn"><span class="fn">self</span>.<a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext.inputString">inputString</a></span>.<a href="../.././Init/Prelude.html#String.rawEndPos">rawEndPos</a></span></div></li></ul><details id="instances-for-list-Lean.Language.ProcessingContext" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.ProcessingT"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L362-L363">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingT</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">m</span> : <span class="fn"><a href="../.././foundational_types.html">Type</a> → <a href="../.././foundational_types.html">Type</a> u_1</span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a> u_1</div></div><p>Monad transformer holding all relevant data for processing.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">Lean.Language.ProcessingT</a> <span class="fn">m</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Init/Prelude.html#ReaderT">ReaderT</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingContext">Lean.Language.ProcessingContext</a> <span class="fn">m</span></span></li></ul></details><details id="instances-for-list-Lean.Language.ProcessingT" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.ProcessingM"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L364-L365">source</a></div><div class="attributes">@[reducible, inline]</div>
<div class="decl_header"><span class="decl_kind">abbrev</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">ProcessingM</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>Monad holding all relevant data for processing.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">Lean.Language.ProcessingM</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">Lean.Language.ProcessingT</a> <a href="../.././Init/System/IO.html#BaseIO">BaseIO</a></span></li></ul></details><details id="instances-for-list-Lean.Language.ProcessingM" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.instMonadLiftProcessingMProcessingTIO"><div class="instance"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L367-L368">source</a></div><div class="attributes">@[instance_reducible]</div>
<div class="decl_header"><span class="decl_kind">instance</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.instMonadLiftProcessingMProcessingTIO"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">instMonadLiftProcessingMProcessingTIO</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/Prelude.html#MonadLift">MonadLift</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">ProcessingM</a> <span class="fn">(<a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">ProcessingT</a> <a href="../.././Init/System/IO.html#IO">IO</a>)</span></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Lean/Language/Basic.html#Lean.Language.instMonadLiftProcessingMProcessingTIO">Lean.Language.instMonadLiftProcessingMProcessingTIO</a> <a href="../.././Init/Prelude.html#Eq">=</a>   <a href="../.././Init/Prelude.html#MonadLift.mk">{</a>     <span class="fn">monadLift</span> := <span class="fn">fun {<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>} (<span class="fn">act</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">Lean.Language.ProcessingM</a> <span class="fn">α</span></span>) (<span class="fn">ctx</span> : <a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingContext">Lean.Language.ProcessingContext</a>) =&gt;
      <span class="fn"><a href="../.././Init/Prelude.html#liftM">liftM</a> <span class="fn">(<span class="fn">act</span> <span class="fn">ctx</span>)</span></span></span> <a href="../.././Init/Prelude.html#MonadLift.mk">}</a></li></ul></details></div></div><div class="decl" id="Lean.Language.Snapshot.Diagnostics.ofMessageLog"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L370-L376">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.ofMessageLog"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">Snapshot</span>.<span class="name">Diagnostics</span>.<span class="name">ofMessageLog</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">msgLog</span> : <a href="../.././Lean/Message.html#Lean.MessageLog">MessageLog</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Diagnostics</a></span></div></div><p>Creates snapshot message log from non-interactive message log, also allocating a mutable cell
that can be used by the server to memorize interactive diagnostics derived from the log.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics.ofMessageLog">Lean.Language.Snapshot.Diagnostics.ofMessageLog</a> <span class="fn">msgLog</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href="../.././Init/System/IO.html#IO.mkRef">IO.mkRef</a> <a href="../.././Init/Prelude.html#Option.none">none</a></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <a href="../.././Lean/Language/Basic.html#_private.Lean.Language.Basic.0.Lean.Language.Snapshot.Diagnostics.mk">{</a> <span class="fn">msgLog</span> := <span class="fn">msgLog</span>, <span class="fn">interactiveDiagsRef?</span> := <span class="fn"><a href="../.././Init/Prelude.html#Option.some">some</a> <span class="fn">__do_lift</span></span> <a href="../.././Lean/Language/Basic.html#_private.Lean.Language.Basic.0.Lean.Language.Snapshot.Diagnostics.mk">}</a></span></span></li></ul></details><details id="instances-for-list-Lean.Language.Snapshot.Diagnostics.ofMessageLog" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.diagnosticsOfHeaderError"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L378-L386">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.diagnosticsOfHeaderError"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">diagnosticsOfHeaderError</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">msg</span> : <a href="../.././Init/Prelude.html#String">String</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">ProcessingM</a> <a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot.Diagnostics">Snapshot.Diagnostics</a></span></div></div><p>Creates diagnostics from a single error message that should span the whole file.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.diagnosticsOfHeaderError" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.withHeaderExceptions"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L388-L394">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.withHeaderExceptions"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">withHeaderExceptions</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">ex</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.Snapshot">Snapshot</a> → <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">act</span> : <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingT">ProcessingT</a> <a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">ProcessingM</a> <span class="fn">α</span></span></div></div><p>Adds unexpected exceptions from header processing to the message log as a last resort; standard
errors should already have been caught earlier.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.withHeaderExceptions" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.Language.mkIncrementalProcessor"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Lean/Language/Basic.lean#L398-L407">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Lean/Language/Basic.html#Lean.Language.mkIncrementalProcessor"><span class="name">Lean</span>.<span class="name">Language</span>.<span class="name">mkIncrementalProcessor</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">InitSnap</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">process</span> : <span class="fn"><span class="fn"><a href="../.././Init/Prelude.html#Option">Option</a> <span class="fn">InitSnap</span></span> → <span class="fn"><a href="../.././Lean/Language/Basic.html#Lean.Language.ProcessingM">ProcessingM</a> <span class="fn">InitSnap</span></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">(<a href="../.././Lean/Parser/Types.html#Lean.Parser.InputContext">Parser.InputContext</a> → <span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <span class="fn">InitSnap</span></span>)</span></span></div></div><p>Builds a function for processing a language using incremental snapshots by passing the previous
snapshot to <code>Language.process</code> on subsequent invocations.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Lean.Language.mkIncrementalProcessor" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>