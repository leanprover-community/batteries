<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href=".././style.css"></link><link rel="icon" href=".././favicon.svg"></link><link rel="mask-icon" href=".././favicon.svg" color="#000000"></link><link rel="prefetch" href=".././/declarations/declaration-data.bmp" as="image"></link><title>Lean.ImportingFlag</title><script defer="true" src=".././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT=".././";</script><script>const MODULE_NAME="Lean.ImportingFlag";</script><script type="module" src=".././jump-src.js"></script><script type="module" src=".././search.js"></script><script type="module" src=".././expand-nav.js"></script><script type="module" src=".././how-about.js"></script><script type="module" src=".././instances.js"></script><script type="module" src=".././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Lean</span>.<span class="name">ImportingFlag</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/ImportingFlag.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href=".././Init/System/IO.html">Init.System.IO</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Lean.ImportingFlag" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Lean.enableInitializersExecution"><span class="name">Lean</span>.<span class="name">enableInitializersExecution</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.isInitializerExecutionEnabled"><span class="name">Lean</span>.<span class="name">isInitializerExecutionEnabled</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.initializing"><span class="name">Lean</span>.<span class="name">initializing</span></a></div><div class="nav_link"><a class="break_within" href="#Lean.withImporting"><span class="name">Lean</span>.<span class="name">withImporting</span></a></div></nav><main>
<div class="decl" id="Lean.enableInitializersExecution"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/ImportingFlag.lean#L18-L32">source</a></div><div class="attributes">@[export lean_enable_initializer_execution]</div>
<div class="decl_header"><span class="decl_kind">unsafe def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/ImportingFlag.html#Lean.enableInitializersExecution"><span class="name">Lean</span>.<span class="name">enableInitializersExecution</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Unit">Unit</a></span></div></div><p>By default the <code>initialize</code> code is not executed when importing .olean files.
When this flag is set to <code>true</code>, the initializers are executed.
This method is meant to be used by the Lean frontend only.
Remark: it is not safe to run <code>initialize</code> code when using multiple threads.
Remark: Any loaded native Lean code must match its imported version. In particular,
no two versions of the same module may be loaded when this flag is set.
No native code may be loaded after its module has been imported.
Remark: Compacted module regions must not be freed when using this flag as the
cached initializer results may reference objects in them.
Remark: The Lean frontend executes this method at startup time.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/ImportingFlag.html#Lean.enableInitializersExecution">Lean.enableInitializersExecution</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.set">ST.Ref.set</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.runInitializersRef">Lean.runInitializersRef✝</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span></li></ul></details><details id="instances-for-list-Lean.enableInitializersExecution" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.isInitializerExecutionEnabled"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/ImportingFlag.lean#L34-L35">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/ImportingFlag.html#Lean.isInitializerExecutionEnabled"><span class="name">Lean</span>.<span class="name">isInitializerExecutionEnabled</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/ImportingFlag.html#Lean.isInitializerExecutionEnabled">Lean.isInitializerExecutionEnabled</a> <a href=".././Init/Prelude.html#Eq">=</a> <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.runInitializersRef">Lean.runInitializersRef✝</a></span></li></ul></details><details id="instances-for-list-Lean.isInitializerExecutionEnabled" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.initializing"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/ImportingFlag.lean#L37-L42">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/ImportingFlag.html#Lean.initializing"><span class="name">Lean</span>.<span class="name">initializing</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <a href=".././Init/Prelude.html#Bool">Bool</a></span></div></div><p>We say Lean is &quot;initializing&quot; when it is executing <code>builtin_initialize</code> declarations or importing modules.
Recall that Lean executes <code>initialize</code> declarations while importing modules.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href=".././Lean/ImportingFlag.html#Lean.initializing">Lean.initializing</a> <a href=".././Init/Prelude.html#Eq">=</a> (<span class="fn"><a href=".././Init/Prelude.html#liftM">liftM</a> <a href=".././Init/System/IO.html#IO.initializing">IO.initializing</a></span> <a href=".././Init/Control/Basic.html#orM">&lt;||&gt;</a> <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.get">ST.Ref.get</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.importingRef">Lean.importingRef✝</a></span>)</li></ul></details><details id="instances-for-list-Lean.initializing" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Lean.withImporting"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/744f98064b056ee27fc8c97f524797c8cc96f436/src/Lean/ImportingFlag.lean#L44-L60">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href=".././Lean/ImportingFlag.html#Lean.withImporting"><span class="name">Lean</span>.<span class="name">withImporting</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href=".././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href=".././Init/System/IO.html#IO">IO</a> <span class="fn">α</span></span></div></div><p>Execute <code>x</code> with &quot;importing&quot; flag turned on.
When the &quot;importing&quot; flag is set to true, we allow user-extensions defined with
the <code>initialize</code> command to update global references.
IMPORTANT: There is no semaphore controlling the access to these global references.
We assume these global references are updated by a single execution thread.
This is true in the Lean frontend where we process the <code>import</code> commands at the beginning
of the execution only. Users must make sure that when <code>importModules</code> is used, there is only
one execution thread accessing the global references.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><a href=".././Lean/ImportingFlag.html#Lean.withImporting">Lean.withImporting</a> <span class="fn">x</span></span> <a href=".././Init/Prelude.html#Eq">=</a>   <span class="fn"><a href=".././Init/Control/Except.html#tryFinally">tryFinally</a>
    <span class="fn">(do
      <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.set">ST.Ref.set</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.importingRef">Lean.importingRef✝</a> <a href=".././Init/Prelude.html#Bool.true">true</a></span>
      <span class="fn">x</span>)</span>
    <span class="fn">do
    <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.set">ST.Ref.set</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.importingRef">Lean.importingRef✝¹</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span>
    <span class="fn"><a href=".././Init/System/ST.html#ST.Ref.set">ST.Ref.set</a> <a href=".././Lean/ImportingFlag.html#_private.Lean.ImportingFlag.0.Lean.runInitializersRef">Lean.runInitializersRef✝</a> <a href=".././Init/Prelude.html#Bool.false">false</a></span></span></span></li></ul></details><details id="instances-for-list-Lean.withImporting" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src=".././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>