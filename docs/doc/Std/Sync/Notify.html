<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../.././style.css"></link><link rel="icon" href="../.././favicon.svg"></link><link rel="mask-icon" href="../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../.././/declarations/declaration-data.bmp" as="image"></link><title>Std.Sync.Notify</title><script defer="true" src="../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../.././";</script><script>const MODULE_NAME="Std.Sync.Notify";</script><script type="module" src="../.././jump-src.js"></script><script type="module" src="../.././search.js"></script><script type="module" src="../.././expand-nav.js"></script><script type="module" src="../.././how-about.js"></script><script type="module" src="../.././instances.js"></script><script type="module" src="../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">Std</span>.<span class="name">Sync</span>.<span class="name">Notify</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../.././Init/Data/Queue.html">Init.Data.Queue</a></li><li><a href="../.././Std/Sync/Mutex.html">Std.Sync.Mutex</a></li><li><a href="../.././Std/Internal/Async/Select.html">Std.Internal.Async.Select</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-Std.Sync.Notify" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Std.Notify.Consumer"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">Consumer</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Notify.Consumer.resolve"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">Consumer</span>.<span class="name">resolve</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Notify.State"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">State</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Notify"><span class="name">Std</span>.<span class="name">Notify</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Notify.new"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">new</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Notify.notify"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">notify</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Notify.notifyOne"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">notifyOne</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Notify.wait"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">wait</span></a></div><div class="nav_link"><a class="break_within" href="#Std.Notify.selector"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">selector</span></a></div></nav><main>
<div class="mod_doc"><p>This module contains the implementation of <code><a href="../.././Std/Sync/Notify.html#Std.Notify">Std.Notify</a></code>. <code><a href="../.././Std/Sync/Notify.html#Std.Notify">Std.Notify</a></code> provides a lightweight
notification primitive for signaling between tasks or threads. It supports both synchronous
and asynchronous waiting, and is useful for cases where you want to notify one or more waiters
that an event has occurred.</p><p>Unlike a channel, <code><a href="../.././Std/Sync/Notify.html#Std.Notify">Std.Notify</a></code> does not buffer messages or carry data. It's simply a trigger.
If no one is waiting, notifications are lost. If one or more waiters are present, exactly one
will be woken up per notification.</p></div><div class="decl" id="Std.Notify.Consumer"><div class="inductive"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L29-L31">source</a></div><div class="decl_header"><span class="decl_kind">inductive</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify.Consumer"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">Consumer</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><ul class="constructors"><li class="constructor" id="Std.Notify.Consumer.normal">normal<span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">promise</span> : <span class="fn"><a href="../.././Init/System/Promise.html#IO.Promise">IO.Promise</a> <span class="fn">α</span></span>)</span></span>
 : <span class="fn"><a href="../.././Std/Sync/Notify.html#Std.Notify.Consumer">Consumer</a> <span class="fn">α</span></span></li><li class="constructor" id="Std.Notify.Consumer.select">select<span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">finished</span> : <span class="fn"><a href="../.././Std/Internal/Async/Select.html#Std.Internal.IO.Async.Waiter">Internal.IO.Async.Waiter</a> <span class="fn">α</span></span>)</span></span>
 : <span class="fn"><a href="../.././Std/Sync/Notify.html#Std.Notify.Consumer">Consumer</a> <span class="fn">α</span></span></li></ul><details id="instances-for-list-Std.Notify.Consumer" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Notify.Consumer.resolve"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L33-L43">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify.Consumer.resolve"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">Consumer</span>.<span class="name">resolve</span></a></span><span class="impl_arg"><span class="decl_args">
<span class="fn">{<span class="fn">α</span> : <a href="../.././foundational_types.html">Type</a>}</span></span>
</span><span class="decl_args">
<span class="fn">(<span class="fn">c</span> : <span class="fn"><a href="../.././Std/Sync/Notify.html#Std.Notify.Consumer">Consumer</a> <span class="fn">α</span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <span class="fn">α</span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><details><summary>Equations</summary><ul class="equations"><li class="equation"><span class="fn"><span class="fn"><span class="fn">(<a href="../.././Std/Sync/Notify.html#Std.Notify.Consumer.normal">Std.Notify.Consumer.normal</a> <span class="fn">promise</span>)</span>.<a href="../.././Std/Sync/Notify.html#Std.Notify.Consumer.resolve">resolve</a></span> <span class="fn">x</span></span> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  <span class="fn"><a href="../.././Init/System/Promise.html#IO.Promise.resolve">IO.Promise.resolve</a> <span class="fn">x</span> <span class="fn">promise</span></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <a href="../.././Init/Prelude.html#Bool.true">true</a></span></span></li><li class="equation"><span class="fn"><span class="fn"><span class="fn">(<a href="../.././Std/Sync/Notify.html#Std.Notify.Consumer.select">Std.Notify.Consumer.select</a> <span class="fn">waiter</span>)</span>.<a href="../.././Std/Sync/Notify.html#Std.Notify.Consumer.resolve">resolve</a></span> <span class="fn">x</span></span> <a href="../.././Init/Prelude.html#Eq">=</a>   <span class="fn"><span class="fn"><span class="fn">waiter</span>.<a href="../.././Std/Internal/Async/Select.html#Std.Internal.IO.Async.Waiter.race">race</a></span> <span class="fn">(<a href="../.././Init/Prelude.html#Pure.pure">pure</a> <a href="../.././Init/Prelude.html#Bool.false">false</a>)</span> <span class="fn">fun (<span class="fn">promise</span> : <span class="fn"><a href="../.././Init/System/Promise.html#IO.Promise">IO.Promise</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except">Except</a> <a href="../.././Init/System/IOError.html#IO.Error">IO.Error</a> <span class="fn">α</span>)</span></span>) =&gt; <span class="fn">do
    <span class="fn"><a href="../.././Init/System/Promise.html#IO.Promise.resolve">IO.Promise.resolve</a> <span class="fn">(<a href="../.././Init/Prelude.html#Except.ok">Except.ok</a> <span class="fn">x</span>)</span> <span class="fn">promise</span></span>
    <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <a href="../.././Init/Prelude.html#Bool.true">true</a></span></span></span></span></li></ul></details><details id="instances-for-list-Std.Notify.Consumer.resolve" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Notify.State"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L45-L53">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify.State"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">State</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>The central state structure for a <code><a href="../.././Std/Sync/Notify.html#Std.Notify">Notify</a></code>.</p><ul class="structure_fields" id="Std.Notify.State.mk"><li id="Std.Notify.State.consumers" class="structure_field"><div class="structure_field_info">consumers : <span class="fn"><a href="../.././Init/Data/Queue.html#Std.Queue">Queue</a> <span class="fn">(<a href="../.././Std/Sync/Notify.html#Std.Notify.Consumer">Consumer</a> <a href="../.././Init/Prelude.html#Unit">Unit</a>)</span></span></div><div class="structure_field_doc"><h2 id="Consumers-that-are-blocked-waiting-for-a-notification" class="markdown-heading">Consumers that are blocked waiting for a notification. <a class="hover-link" href="#Consumers-that-are-blocked-waiting-for-a-notification">#</a></h2></div></li></ul><details id="instances-for-list-Std.Notify.State" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Notify"><div class="structure"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L55-L60">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify"><span class="name">Std</span>.<span class="name">Notify</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../.././foundational_types.html">Type</a></div></div><p>A notify is a synchronization primitive that allows multiple consumers to wait
until notify is called.</p><ul class="structure_fields" id="Std.Notify.mk"><li id="Std.Notify.state" class="structure_field"><div class="structure_field_info">state : <span class="fn"><a href="../.././Std/Sync/Mutex.html#Std.Mutex">Mutex</a> <a href="../.././Std/Sync/Notify.html#Std.Notify.State">State</a></span></div></li></ul><details id="instances-for-list-Std.Notify" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Notify.new"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L64-L68">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify.new"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">new</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Std/Sync/Notify.html#Std.Notify">Notify</a></span></div></div><p>Create a new notify.</p><details><summary>Equations</summary><ul class="equations"><li class="equation"><a href="../.././Std/Sync/Notify.html#Std.Notify.new">Std.Notify.new</a> <a href="../.././Init/Prelude.html#Eq">=</a> <span class="fn">do
  let <span class="fn">__do_lift</span> ← <span class="fn"><a href="../.././Std/Sync/Mutex.html#Std.Mutex.new">Std.Mutex.new</a> <a href="../.././Std/Sync/Notify.html#Std.Notify.State.mk">{</a> <span class="fn">consumers</span> := <a href="../.././Init/Core.html#EmptyCollection.emptyCollection">∅</a> <a href="../.././Std/Sync/Notify.html#Std.Notify.State.mk">}</a></span>
  <span class="fn"><a href="../.././Init/Prelude.html#Pure.pure">pure</a> <a href="../.././Std/Sync/Notify.html#Std.Notify.mk">{</a> <span class="fn">state</span> := <span class="fn">__do_lift</span> <a href="../.././Std/Sync/Notify.html#Std.Notify.mk">}</a></span></span></li></ul></details><details id="instances-for-list-Std.Notify.new" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Notify.notify"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L70-L87">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify.notify"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">notify</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <a href="../.././Std/Sync/Notify.html#Std.Notify">Notify</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Notify all currently waiting consumers.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Notify.notify" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Notify.notifyOne"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L89-L102">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify.notifyOne"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">notifyOne</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <a href="../.././Std/Sync/Notify.html#Std.Notify">Notify</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#BaseIO">BaseIO</a> <a href="../.././Init/Prelude.html#Bool">Bool</a></span></div></div><p>Notify exactly one waiting consumer (if any). Returns true if a consumer
was notified, false if no consumers were waiting.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Notify.notifyOne" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Notify.wait"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L104-L114">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify.wait"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">wait</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">x</span> : <a href="../.././Std/Sync/Notify.html#Std.Notify">Notify</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Init/System/IO.html#IO">IO</a> <span class="fn">(<a href="../.././Std/Internal/Async/Basic.html#Std.Internal.IO.Async.AsyncTask">Internal.IO.Async.AsyncTask</a> <a href="../.././Init/Prelude.html#Unit">Unit</a>)</span></span></div></div><p>Wait to be notified. Returns a task that completes when notify is called.
Note: if notify was called before wait, this will wait for the next notify call.</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Notify.wait" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Std.Notify.selector"><div class="def"><div class="gh_link"><a href="https://github.com/leanprover/lean4/blob/985f350dcd18fc7814dfa677cac09933f44f3215/src/Std/Sync/Notify.lean#L116-L136">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../.././Std/Sync/Notify.html#Std.Notify.selector"><span class="name">Std</span>.<span class="name">Notify</span>.<span class="name">selector</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">notify</span> : <a href="../.././Std/Sync/Notify.html#Std.Notify">Notify</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../.././Std/Internal/Async/Select.html#Std.Internal.IO.Async.Selector">Internal.IO.Async.Selector</a> <a href="../.././Init/Prelude.html#Unit">Unit</a></span></div></div><p>Creates a selector that waits for notifications</p><details><summary>Equations</summary><ul class="equations"><li class="equation">One or more equations did not get rendered due to their size.</li></ul></details><details id="instances-for-list-Std.Notify.selector" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>